{"componentChunkName":"component---src-templates-blog-post-blog-post-jsx","path":"/how-we-upgraded-3d-secure","webpackCompilationHash":"af0d433c34faf3828349","result":{"data":{"contentfulWebBlogPost":{"id":"616d9539-2ff6-570e-b504-8de488889621","webSlug":"/how-we-upgraded-3d-secure","title":"How we upgraded 3D Secure","description":{"description":"We’ve upgraded to the new version of 3D Secure. Backend engineer Arthur explains how we did it.\n"},"slug":"/how-we-upgraded-3d-secure","startDate":"2020-01-29T10:00+00:00","isFeaturedPost":null,"authors":[{"id":"608f5750-9a6c-5bfa-ad84-500769dc4fac","name":"Arthur Ceccotti","jobTitle":{"text":"Backend Engineer"},"profilePicture":{"file":{"url":"//images.ctfassets.net/ro61k101ee59/6a1Yac2oS7PFqTQjB7lI8a/60165fa243eb115c93d71300ad45eae9/ArthurPic.jpg"}}}],"blogContent":{"content":{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[],"value":"You’re binge-watching Netflix at home. You get a message from your bank saying, wait,  when did I buy £3,000 plane tickets to the Bahamas?!","nodeType":"text"}],"nodeType":"paragraph"},{"data":{},"content":[{"data":{},"marks":[],"value":"It’s a nightmare lots of people have sadly had to experience in the past: a fraudster got hold of your card details and used them to steal from you.","nodeType":"text"}],"nodeType":"paragraph"},{"data":{},"content":[{"data":{},"marks":[],"value":"Monzo, like other banks, helps stop this from happening using something called 3D Secure.","nodeType":"text"}],"nodeType":"paragraph"},{"data":{},"content":[{"data":{},"marks":[],"value":"What is 3D Secure?","nodeType":"text"}],"nodeType":"heading-2"},{"data":{},"content":[{"data":{},"marks":[],"value":"3D Secure is a payment standard that aims to reduce e-commerce fraud by adding two-factor authentication to online transactions. ","nodeType":"text"}],"nodeType":"paragraph"},{"data":{},"content":[{"data":{},"marks":[],"value":"When you buy something online, the merchant pop-ups with a window that asks you to confirm that it’s really you making the payment. ","nodeType":"text"}],"nodeType":"paragraph"},{"data":{},"content":[{"data":{},"marks":[],"value":"That means if your card is stolen, unless the thief has your phone and PIN, they won’t be able to buy first class tickets anywhere.","nodeType":"text"}],"nodeType":"paragraph"},{"data":{"target":{"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"ro61k101ee59","contentful_id":"ro61k101ee59"}},"id":"c3qjab4fgz2V8rlchYSC21w","type":"Asset","createdAt":"2020-01-29T08:48:00.212Z","updatedAt":"2020-01-29T08:48:00.212Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment","contentful_id":"master"}},"revision":1,"contentful_id":"3qjab4fgz2V8rlchYSC21w"},"fields":{"title":{"en-GB":"3D Secure with Monzo"},"description":{"en-GB":"Image of 3D Secure with Monzo"},"file":{"en-GB":{"url":"//images.ctfassets.net/ro61k101ee59/3qjab4fgz2V8rlchYSC21w/7668d36001a79cecd35bcc13bc775fad/Screenshot_2020-01-28_at_17.11.55.png","details":{"size":39350,"image":{"width":397,"height":382}},"fileName":"Screenshot 2020-01-28 at 17.11.55.png","contentType":"image/png"}}}}},"content":[],"nodeType":"embedded-asset-block"},{"data":{},"content":[{"data":{},"marks":[],"value":"We want to keep your money safe, so we follow these standards with the help of Mastercard, who is the middle-man of transaction processing (also known as our network).","nodeType":"text"}],"nodeType":"paragraph"},{"data":{},"content":[{"data":{},"marks":[],"value":"Why are we upgrading to 3DS2?","nodeType":"text"}],"nodeType":"heading-2"},{"data":{},"content":[{"data":{},"marks":[],"value":"Right now most websites use 3DS version 1 (3DS1) for two-factor authentication. But Mastercard recently added support for a new version, known as 3DS2. This version has a few advantages, including:","nodeType":"text"}],"nodeType":"paragraph"},{"data":{},"content":[{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[{"type":"bold"}],"value":"Additional information: ","nodeType":"text"},{"data":{},"marks":[],"value":"We can now take advantage of much more information to decide if it’s really you making the payment. We can now use your device details, merchant website/app details, authentication already performed by the merchant (like logging into an app with your fingerprint) to say more accurately whether it’s really you.","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"list-item"}],"nodeType":"unordered-list"},{"data":{},"content":[{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[{"type":"bold"}],"value":"Frictionless authentication","nodeType":"text"},{"data":{},"marks":[],"value":": We can decide not to challenge you if we decide the risk is very low. We can do this if the transaction value is low or based on your shopping habits. For example, if you already shop at Just Eat every Friday night, we don’t want to bother you every week asking if it was really you. This is something we’re still working on!","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"list-item"}],"nodeType":"unordered-list"},{"data":{},"content":[{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[{"type":"bold"}],"value":"A better user experience","nodeType":"text"},{"data":{},"marks":[],"value":": the Monzo pop-up window now has native Android and iOS support or as a modal on your web-browser. This will make for better-looking and smoother mobile checkouts.","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"list-item"}],"nodeType":"unordered-list"},{"data":{},"content":[{"data":{},"marks":[],"value":"\n...And ","nodeType":"text"},{"data":{"uri":"https://nudatasecurity.com/resources/blog/emv-3ds-or-3ds2-the-old-the-new-and-the-better/"},"content":[{"data":{},"marks":[{"type":"underline"}],"value":"much more","nodeType":"text"}],"nodeType":"hyperlink"},{"data":{},"marks":[],"value":"!","nodeType":"text"}],"nodeType":"paragraph"},{"data":{},"content":[{"data":{},"marks":[],"value":"How does 3DS2 actually work?","nodeType":"text"}],"nodeType":"heading-2"},{"data":{},"content":[{"data":{},"marks":[],"value":"Understanding how 3D Secure works is fairly complicated, and involves reading a ","nodeType":"text"},{"data":{"uri":"https://www.emvco.com/terms-of-use/?u=/wp-content/uploads/documents/EMVCo_3DS_Spec_210_1017_0318.pdf"},"content":[{"data":{},"marks":[{"type":"underline"}],"value":"255 page technical document","nodeType":"text"}],"nodeType":"hyperlink"},{"data":{},"marks":[],"value":".","nodeType":"text"}],"nodeType":"paragraph"},{"data":{},"content":[{"data":{},"marks":[],"value":"It involves communication between:","nodeType":"text"}],"nodeType":"paragraph"},{"data":{},"content":[{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[{"type":"italic"}],"value":"3DS client","nodeType":"text"},{"data":{},"marks":[],"value":" - the merchant website or mobile app","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"list-item"},{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[{"type":"italic"}],"value":"DS ","nodeType":"text"},{"data":{},"marks":[],"value":"(Directory Server) ","nodeType":"text"},{"data":{},"marks":[{"type":"italic"}],"value":"server ","nodeType":"text"},{"data":{},"marks":[],"value":"- the middle-man in charge of routing requests - in our case this is owned by ","nodeType":"text"},{"data":{},"marks":[{"type":"italic"}],"value":"Mastercard","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"list-item"},{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[{"type":"italic"}],"value":"ACS ","nodeType":"text"},{"data":{},"marks":[],"value":"(Access Control) ","nodeType":"text"},{"data":{},"marks":[{"type":"italic"}],"value":"server  - ","nodeType":"text"},{"data":{},"marks":[],"value":"the system owned by the issuer (Monzo) in charge of making the ultimate decisions regarding 3DS challenges\n","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"list-item"}],"nodeType":"unordered-list"},{"data":{"target":{"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"ro61k101ee59","contentful_id":"ro61k101ee59"}},"id":"c6nXZRLJvL7nYELVDXWjMxZ","type":"Asset","createdAt":"2020-01-29T08:53:06.631Z","updatedAt":"2020-01-29T08:53:06.631Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment","contentful_id":"master"}},"revision":1,"contentful_id":"6nXZRLJvL7nYELVDXWjMxZ"},"fields":{"title":{"en-GB":"How 3D secure works"},"description":{"en-GB":"How 3D secure works"},"file":{"en-GB":{"url":"//images.ctfassets.net/ro61k101ee59/6nXZRLJvL7nYELVDXWjMxZ/229f340ce2346035c7ef90eb27650852/Screenshot_2020-01-28_at_17.15.26.png","details":{"size":426738,"image":{"width":1520,"height":1284}},"fileName":"Screenshot 2020-01-28 at 17.15.26.png","contentType":"image/png"}}}}},"content":[],"nodeType":"embedded-asset-block"},{"data":{},"content":[{"data":{},"marks":[],"value":"The 3DS flow involves the exchange of multiple messages, which goes as follows:","nodeType":"text"}],"nodeType":"paragraph"},{"data":{},"content":[{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[{"type":"bold"}],"value":"Authentication Request","nodeType":"text"},{"data":{},"marks":[],"value":": As soon as the customer reaches the check-out page of the merchant (ie. online shop), the merchant sends the DS Server a request saying “","nodeType":"text"},{"data":{},"marks":[{"type":"italic"}],"value":"I want to challenge this customer","nodeType":"text"},{"data":{},"marks":[],"value":"” (known as an ","nodeType":"text"},{"data":{},"marks":[{"type":"italic"}],"value":"AReq","nodeType":"text"},{"data":{},"marks":[],"value":" or ","nodeType":"text"},{"data":{},"marks":[{"type":"italic"}],"value":"Authentication Request","nodeType":"text"},{"data":{},"marks":[],"value":").","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"list-item"},{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[{"type":"bold"}],"value":"Authentication Response","nodeType":"text"},{"data":{},"marks":[],"value":": Mastercard forwards that request to Monzo (the ACS server), which will respond with an ","nodeType":"text"},{"data":{},"marks":[{"type":"italic"}],"value":"ARes","nodeType":"text"},{"data":{},"marks":[],"value":" (or ","nodeType":"text"},{"data":{},"marks":[{"type":"italic"}],"value":"Authentication Response","nodeType":"text"},{"data":{},"marks":[],"value":"). This will contain one of the following outcomes:","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"list-item"},{"data":{},"content":[{"data":{},"content":[{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[{"type":"italic"}],"value":"Ok, I also want to challenge this customer ","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"list-item"},{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[{"type":"italic"}],"value":"Sorry, this customer is not enrolled for 3DSv2 yet ","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"list-item"},{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[{"type":"italic"}],"value":"No, let’s not challenge them and stop right here. Their card is frozen or blocked","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"list-item"},{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[{"type":"italic"}],"value":"No it’s fine, we don’t need to challenge them. The transaction value is too low, it’s not worth bothering them ","nodeType":"text"},{"data":{},"marks":[],"value":"(known as a frictionless flow)","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"list-item"}],"nodeType":"ordered-list"}],"nodeType":"list-item"},{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[{"type":"bold"}],"value":"Challenge Request","nodeType":"text"},{"data":{},"marks":[{"type":"italic"}],"value":": ","nodeType":"text"},{"data":{},"marks":[],"value":"If the merchant gets a response from Monzo confirming we want to challenge the customer, it’ll send Monzo (via the DS Server) a ","nodeType":"text"},{"data":{},"marks":[{"type":"italic"}],"value":"CReq ","nodeType":"text"},{"data":{},"marks":[],"value":"(","nodeType":"text"},{"data":{},"marks":[{"type":"italic"}],"value":"Challenge Request","nodeType":"text"},{"data":{},"marks":[],"value":"), meaning ","nodeType":"text"},{"data":{},"marks":[{"type":"italic"}],"value":"“Let’s start a challenge”.","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"list-item"},{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[{"type":"bold"}],"value":"Challenge Response","nodeType":"text"},{"data":{},"marks":[{"type":"italic"}],"value":": ","nodeType":"text"},{"data":{},"marks":[],"value":"Monzo responds with a ","nodeType":"text"},{"data":{},"marks":[{"type":"italic"}],"value":"CRes","nodeType":"text"},{"data":{},"marks":[],"value":" (","nodeType":"text"},{"data":{},"marks":[{"type":"italic"}],"value":"Challenge Response","nodeType":"text"},{"data":{},"marks":[],"value":") containing a pop-up window that asks the customer to confirm their identity on the app.","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"list-item"},{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[{"type":"bold"}],"value":"Result Request","nodeType":"text"},{"data":{},"marks":[],"value":": Once the customer confirms their identity, Monzo sends back to the merchant (via the Mastercard DS server) an ","nodeType":"text"},{"data":{},"marks":[{"type":"italic"}],"value":"RReq","nodeType":"text"},{"data":{},"marks":[],"value":" (","nodeType":"text"},{"data":{},"marks":[{"type":"italic"}],"value":"Result Request","nodeType":"text"},{"data":{},"marks":[],"value":") with the outcome. If the outcome was an approval, this result includes a cryptogram called ","nodeType":"text"},{"data":{},"marks":[{"type":"italic"}],"value":"IAV","nodeType":"text"},{"data":{},"marks":[],"value":" (","nodeType":"text"},{"data":{},"marks":[{"type":"italic"}],"value":"Issuer Authorization Value","nodeType":"text"},{"data":{},"marks":[],"value":"). ","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"list-item"},{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[{"type":"bold"}],"value":"Result Response","nodeType":"text"},{"data":{},"marks":[],"value":": The DS server acknowledges the final results.","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"list-item"},{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[{"type":"bold"}],"value":"Authorization","nodeType":"text"},{"data":{},"marks":[],"value":": If the result was successful, the merchant can finally initiate the payment to take money from the customer’s account (known as an authorization), using the ","nodeType":"text"},{"data":{},"marks":[{"type":"italic"}],"value":"IAV","nodeType":"text"},{"data":{},"marks":[],"value":" cryptogram as proof that this user is definitely who they say they are!","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"list-item"}],"nodeType":"ordered-list"},{"data":{},"content":[{"data":{},"marks":[],"value":"How did we roll-out 3DS2?","nodeType":"text"}],"nodeType":"heading-2"},{"data":{},"content":[{"data":{},"marks":[],"value":"Until now we (and every other bank) have been using 3D Secure version 1. And migrating to a new version is no easy task! Upgrading to 3DS2 involves a complete re-work from the back-end.","nodeType":"text"}],"nodeType":"paragraph"},{"data":{},"content":[{"data":{},"marks":[],"value":"To motivate banks to move to the new version, Mastercard set a deadline in September 2019. After this deadline there’d be a “liability shift,” so if the merchant wants to try a 3DS2 payment and the bank doesn’t support it, the fraud liability would now be on the bank. So if there’s fraud, the bank has to pay the price! ","nodeType":"text"}],"nodeType":"paragraph"},{"data":{},"content":[{"data":{},"marks":[],"value":"So our payments team started work on this version upgrade in the middle of 2019, with the help of a certification testing tool owned by Underwriters Laboratories. We also did one-off tests using ","nodeType":"text"},{"data":{"uri":"https://stripe.com/gb/guides/3d-secure-2"},"content":[{"data":{},"marks":[{"type":"underline"}],"value":"Stripe 3DS2 validation","nodeType":"text"}],"nodeType":"hyperlink"},{"data":{},"marks":[],"value":".","nodeType":"text"}],"nodeType":"paragraph"},{"data":{},"content":[{"data":{},"marks":[],"value":"Initially 3DS2 was only available to a hand-full of payments engineers, as it was in a very early alpha-stage. But after a few months of testing we were ready for real world transactions!","nodeType":"text"}],"nodeType":"paragraph"},{"data":{},"content":[{"data":{},"marks":[],"value":"In November, we partnered with JustEAT and managed to successfully deliver 3DS2 kebabs to the office (victory never tasted so good!).","nodeType":"text"}],"nodeType":"paragraph"},{"data":{},"content":[{"data":{},"marks":[],"value":"But one merchant isn’t enough! So in December we partnered with Skyscanner and this time bought 3DS2 flights to Korea! (This time we couldn’t justify the £1,000 expense and of course got an immediate refund).","nodeType":"text"}],"nodeType":"paragraph"},{"data":{},"content":[{"data":{},"marks":[],"value":"At that point we were confident everything was working as it should, so we decided to enroll 1% of our customers (35,000 people) on the new version. That way we could analyse the data slowly and if something went wrong, there’d be little impact and we could roll-back easily. ","nodeType":"text"}],"nodeType":"paragraph"},{"data":{},"content":[{"data":{},"marks":[],"value":"Over the holiday period, with a steady stream of successful transactions and after making monitoring improvements, we decided we were ready for more! So on the first week of January we rolled out 3DS2 to 10% of our user base, 350,000 people. ","nodeType":"text"}],"nodeType":"paragraph"},{"data":{},"content":[{"data":{},"marks":[],"value":"At this point we had a lot of merchant acceptance issues. Because the 3DS2 standard is fairly new, so many merchants and acquirers have bugs in their implementations. ","nodeType":"text"}],"nodeType":"paragraph"},{"data":{},"content":[{"data":{},"marks":[],"value":"So after some back-and-forth conversations with them, allow-listing certain merchants and working with our partners, we rolled out to 25% - 875,000 people. ","nodeType":"text"}],"nodeType":"paragraph"},{"data":{},"content":[{"data":{},"marks":[],"value":"We’re in the process of making 3DS2 available to every single one of our customers very shortly! At that point we’ll be one of very few UK banks to support the new version and make online shopping a safer experience for our customers 😌","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"document"}},"ogTitle":"How we upgraded 3D Secure","ogDescription":{"text":"We’ve upgraded to the new version of 3D Secure. Backend engineer Arthur explains how we did it.\n"},"ogImage":{"file":{"url":"//images.ctfassets.net/ro61k101ee59/4njZEtb3LqGqpGfjk2NG5o/c9bd86de6eca72ebc0d2fca3050e7e6d/_Blogpost__General_Illustrations-09.png"}},"ogImageUrl":null,"category":[{"categoryName":"How We Protect You","description":null,"image":null}],"discussionId":"90416"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/how-we-upgraded-3d-secure"}}}